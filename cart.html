<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>小米商城-小米官方网站，小米手机、红米手机正品专卖</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script src="js/mui.min.js"></script>
    <script src="js/app.js"></script>
    <link href="css/mui.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/common.css"/>
    <link href="css/cart.css" rel="stylesheet">
    <link href="css/iconfont.css" rel="stylesheet">
    <script type="text/javascript" charset="utf-8">
      	mui.init();
    </script>
</head>
<body>
	<!-- 顶部导航栏开始 -->
	<header class="mui-bar mui-bar-nav">
	    <form action="" class="mui-icon mui-icon-search">
	    	<input type="">
	    </form>
	    <span class="mui-icon iconfont icon-xiaoxi"></span>
	</header>
	<!-- 顶部导航栏结束 -->
	
	<!-- 中间主体区域开始 -->
	<div class="mui-content">
		
		<!-- 购物车内的商品开始 -->
		<ul class="mui-table-view list">
		    <!--<li class="mui-table-view-cell">
		    	<span></span>
		    	<img src="images/g2-1.webp" alt="">
		    	<div>
		    		<h4>小米智能商品1</h4>
		    		<p>文字说明</p>
		    		<em>691元</em>
		    	</div>
		    	<p>
		    		<i class="reduce">-</i>
		    		<input type="text" value="0">
		    		<i class="add">+</i>
		    	</p>
		    </li>-->
		</ul>
		<!-- 购物车内的商品结束 -->
		
		<!-- 金额结算开始 -->
		<section class="total_money">
			<span>
				<em>0</em>
				元
			</span>
			<a href="">结算</a>
		</section>
		<!-- 金额结算结束 -->
		
	  	<!-- 商品店铺开始 -->
   		<div class="mui-row shops">
	        <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img src="images/g2-1.webp" alt="" ></a>
	            <span>单品0</span>
	            <p>最好用</p>
	            <em>
	            	<b>699</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img src="images/g2-2.webp" alt="" ></a>
	            <span>单品1</span>
	            <p>最好用</p>
	            <em>
	            	<b>111</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img src="images/g2-3.webp" alt="" ></a>
	            <span>单品2</span>
	            <p>最好用</p>
	            <em>
	            	<b>222</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img src="images/g2-4.webp" alt="" ></a>
	            <span>单品3</span>
	            <p>最好用</p>
	            <em>
	            	<b>333</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img data-lazyload="images/g2-5.webp" alt="" ></a>
	            <span>单品4</span>
	            <p>最好用</p>
	            <em>
	            	<b>444</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img data-lazyload="images/g2-6.webp" alt="" ></a>
	            <span>单品5</span>
	            <p>最好用</p>
	            <em>
	            	<b>555</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img data-lazyload="images/g2-7.webp" alt="" ></a>
	            <span>单品6</span>
	            <p>最好用</p>
	            <em>
	            	<b>666</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img data-lazyload="images/g2-8.webp" alt="" ></a>
	            <span>单品7</span>
	            <p>最好用</p>
	            <em>
	            	<b>777</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img data-lazyload="images/g2-9.webp" alt="" ></a>
	            <span>单品8</span>
	            <p>最好用</p>
	            <em>
	            	<b>888</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img data-lazyload="images/g2-10.webp" alt="" ></a>
	            <span>单品9</span>
	            <p>最好用</p>
	            <em>
	            	<b>999</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	         <div class="mui-col-sm-6 mui-col-xs-6">
	            <a href=""><img data-lazyload="images/g2-11.webp" alt="" ></a>
	            <span>单品10</span>
	            <p>最好用</p>
	            <em>
	            	<b>1010</b>
	            	<i class="iconfont icon-jiarugouwuche"></i>
	            </em>
	        </div>
	    </div>
	   <!-- 商品店铺结束 -->
	</div>
	<!-- 中间主体区域结束 -->
	
	<!-- 底部固定tab选项卡开始 -->
	<nav class="mui-bar mui-bar-tab" id="bottom_nav">
	    <a class="mui-tab-item" location="index.html">
	        <span class="mui-icon iconfont icon-home"></span>
	        <span class="mui-tab-label">首页</span>
	    </a>
	    <a class="mui-tab-item" location="kinds.html">
	        <span class="mui-icon iconfont icon-tubiao3"></span>
	        <span class="mui-tab-label">分类</span>
	    </a>
	    <a class="mui-tab-item" location="find.html">
	        <span class="mui-icon iconfont icon-faxian"></span>
	        <span class="mui-tab-label">发现</span>
	    </a>
	    <a class="mui-tab-item mui-active" location="cart.html">
	        <span class="mui-icon iconfont icon-order"></span>
	        <span class="mui-tab-label">购物车</span>
	    </a>
	     <a class="mui-tab-item" location="my.html">
	        <span class="mui-icon iconfont icon-wode"></span>
	        <span class="mui-tab-label">我的</span>
	    </a>
	</nav>
	<!-- 底部固定tab选项卡结束 -->
	
	<!-- 图片懒加载 -->
	<script src="js/mui.lazyload.js"></script>
	<script src="js/mui.lazyload.img.js"></script>
	<script>
		mui(document).imageLazyload({
//				selector: '',//查询哪些元素需要lazyload
				diff: 100,//距离视窗底部多少像素触发lazyload
//				force: false,//强制加载(不论元素是否在是视窗内)
//				autoDestroy: true,//元素加载完后是否自动销毁当前插件对象
//				duration: 100//滑动停止多久后开始加载
				placeholder: 'images/logo.jpg'
			});
	</script>
	
	<!-- *****************************重点：用于购物车的js********************** -->
	<script>
		//获取购物车列表容器
		var list = document.querySelector( '.list' );
			total_money = document.querySelector( '.total_money em' );
			
		//封装关于数据读写与存储方法的对象
		var storage = {
			getData : function(){   //从临时缓存中获取的为字符串，需要转换为对象--一般为数组
				//判断：当临时缓存中存在指定属性名时
				if( sessionStorage.info ){
					//将从临时缓存中获取到的字符串转换为对象
					return JSON.parse( sessionStorage.info );
				}else{   //当临时缓存中不存在指定属性名时
					return [];
				}
			},
			saveData : function(data){
				//由于临时缓存会自动将存入的数据自动转换为字符串，因此当存储对象时需要先将对象转化为字符串
				var str = JSON.stringify( data );
				//将转换后的字符串直接存入临时缓存--且确定了属性名为info
				sessionStorage.info = str;
			}
		};
		
		//封装一个主要的购物车对象，用于关于购物车的方法
		var Cart = {
			//获取当前缓存，并将传入的数据继续存进去
			saveStorage : function( info_name, info_src, info_explain, info_price ){
				//获取当前缓存--得到数组
				var currentStorage = storage.getData();
				
				//遍历旧的缓存数据，当旧的缓存数据中与新传入的数据的name相同时，只需增加数组中相应对象元素中的count属性的值
				for( var i = 0; i < currentStorage.length; i++ ){
					//当旧的缓存数据中与新传入的数据的name相同时
					if( info_name == currentStorage[i].name  ){
						//增加数组中相应对象元素中的count属性的值
						currentStorage[i].count++;
						//当找到相同name值的对象时，跳出循环，此时因为没有进行i+1这最后一步，所以i必定会小于数组长度，
						break;
					}
				}
				//只有当传入的数据与已有的数据的name值均不相同时，即i可以达到数组长度时，才会执行缓存数据操作
				if( i == currentStorage.length ){
					//将传入的数据装入对象中，插入到得到的缓存数组中
					currentStorage.push( {
						'name':info_name,
						'src':info_src,
						'explain':info_explain,
						'price':info_price,
						'count':1,
						'checked':true
					} );
				}
				
				//将得到的新数组存入到临时缓存中
				storage.saveData( currentStorage );
//				console.log( currentStorage );
			},
			
			//获取临时缓存的数据，并新建购物车中商品的dom元素，插入到购物车列表中
			show : function(){
				//获取当前缓存--得到数组
				var currentStorage = storage.getData(),
					str 		   = '',
					money 		   = 0;
					
				//遍历临时缓存的数据
				for( var i = 0; i < currentStorage.length; i++ ){
					//根据相应对象元素的checked的属性判断是否为dom元素添加checked
					var state = currentStorage[i].checked? 'checked' : '';
					
					//将缓存的数组取出，按照数组内的对象元素的数量拼接相应数量的字符串
					str += '<li class="mui-table-view-cell">'+
						    	'<span class="' + state + '"></span>'+
						    	'<img src=' + currentStorage[i].src + ' alt="">'+
						    	'<div>'+
						    		'<h4>' + currentStorage[i].name + '</h4>'+
						    		'<p>' + currentStorage[i].explain + '</p>'+
						    		'<em>' + currentStorage[i].price + '元</em>'+
						    	'</div>'+
						    	'<p>'+
						    		'<i class="reduce">-</i>'+
						    		'<input type="text" value=' + currentStorage[i].count + '>'+
						    		'<i class="add">+</i>'+
						    	'</p>'+
						    '</li>';
						    
					//只有当选中商品被选中时，才会计算金额，即当圆圈有类名checked时
					if( currentStorage[i].checked ){
						money += parseInt( currentStorage[i].price*currentStorage[i].count );
					}
				}
				//将拼接后的字符串，用innerHTML的方式插入到到购物车列表中
				list.innerHTML = str;
				//计算总金额
				total_money.innerHTML = money;
				
			},
			
			//根据传入的name值改变商品的选中状态
			changeState : function( name ){
				//获取当前缓存--得到数组
				var currentStorage = storage.getData();
				
				//遍历数组，根据name值找到对应的对象元素，修改其checked值
				for( var i = 0; i < currentStorage.length; i++ ){
					if( name == currentStorage[i].name ){
						//每次调用时，为checked值取反
						currentStorage[i].checked = !currentStorage[i].checked;
						break;
					}
				}
				//将得到的新数组存入到临时缓存中
				storage.saveData( currentStorage );
			},
			
			//根据传入的name值增加商品的数量
			addCount : function( name ){
				//获取当前缓存--得到数组
				var currentStorage = storage.getData();
				
				//遍历数组，根据name值找到对应的对象元素，修改其checked值
				for( var i = 0; i < currentStorage.length; i++ ){
					if( name == currentStorage[i].name ){
						//每次调用时，为checked值取反
						currentStorage[i].count++;
						break;
					}
				}
				//将得到的新数组存入到临时缓存中
				storage.saveData( currentStorage );
			},
			
			//根据传入的name值减少商品的数量
			reduceCount : function( name ){
				//获取当前缓存--得到数组
				var currentStorage = storage.getData();
				
				//遍历数组，根据name值找到对应的对象元素，修改其checked值
				for( var i = 0; i < currentStorage.length; i++ ){
					if( name == currentStorage[i].name ){
						//每次调用时，为checked值取反
						currentStorage[i].count--;
						//当数量小于1时，删除该商品
						if( currentStorage[i].count < 0 ){
							//从数组中删除这一个元素
							currentStorage.splice( i,1 );
						}
						break;
					}
				}
				//将得到的新数组存入到临时缓存中
				storage.saveData( currentStorage );
			}
		}
		
		
		
		//当点击商铺中的加入购物车时
		mui( '.shops' ).on( 'tap', '.icon-jiarugouwuche',function(){
			//获取点击处商铺的商品相关信息
			var info_name = this.parentNode.parentNode.querySelector( 'span' ).innerHTML;
			var info_src = this.parentNode.parentNode.querySelector( 'a img' ).src;
			var info_explain = this.parentNode.parentNode.querySelector( 'p' ).innerHTML;
			var info_price = this.parentNode.querySelector( 'b' ).innerHTML;
			
			//将点击处店铺的相应商品信息存储到临时缓存中
			Cart.saveStorage( info_name, info_src, info_explain, info_price );
			//在页面中显示缓存的信息
			Cart.show();
		} );
		
		//当点击圆圈时，切换选中与取消状态---事件委托只支持mui('css选择器')
		mui( '.list' ).on( 'tap', 'li>span', function(){
			//获取点击处圆圈中的商品姓名
			var name = this.parentNode.querySelector( 'h4' ).innerHTML;
			
			Cart.changeState(name);
			//在页面中显示缓存的信息
			Cart.show();
		} );
		
		//当点击增加按钮时
		mui( '.list' ).on( 'tap', 'li .add', function(){
			//获取点击处圆圈中的商品姓名
			var name = this.parentNode.parentNode.querySelector( 'h4' ).innerHTML;
			
			Cart.addCount(name);
			//在页面中显示缓存的信息
			Cart.show();
		} );
		
		//当点击减少按钮时
		mui( '.list' ).on( 'tap', 'li .reduce', function(){
			//获取点击处圆圈中的商品姓名
			var name = this.parentNode.parentNode.querySelector( 'h4' ).innerHTML;
			
			Cart.reduceCount(name);
			//在页面中显示缓存的信息
			Cart.show();
		} );
	</script>
</body>
